<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba - Cita con Email</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .btn { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .success { background: #28a745; }
        .error { background: #dc3545; }
    </style>
</head>
<body>
    <h1>üß™ Prueba de Cita con Email</h1>
    
    <div>
        <h3>Probar funcionalidad de email:</h3>
        <button class="btn" onclick="probarEmailDirecto()">üìß Probar Email Directo</button>
        <button class="btn success" onclick="probarModalEmail()">ü™ü Probar Modal de Email</button>
    </div>
    
    <div id="resultado" style="margin-top: 20px; padding: 15px; border-radius: 5px;"></div>

    <!-- EMAILJS SCRIPT -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- SCRIPT DE PRUEBA -->
    <script>
        // Inicializar EmailJS
        emailjs.init('tfi1ksSYUgEyQxZ6I');
        
        // Funci√≥n para probar email directo
        async function probarEmailDirecto() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p>‚è≥ Enviando email de prueba...</p>';
            resultado.style.backgroundColor = '#fff3cd';
            resultado.style.color = '#856404';
            
            try {
                const templateParams = {
                    to_email: 'jorge777andres@gmail.com',
                    to_name: 'Paciente de Prueba',
                    fecha_cita: 'lunes, 5 de febrero de 2024',
                    hora_cita: '10:30 AM',
                    doctor: 'Dr. Juan P√©rez',
                    especialidad: 'Cirug√≠a Pl√°stica',
                    clinica_nombre: 'EVA Cirug√≠a Corporal',
                    clinica_direccion: 'Av. Principal 123, Ciudad',
                    clinica_telefono: '(555) 123-4567'
                };
                
                const response = await emailjs.send(
                    'service_2re2org',
                    'template_rxar2ok',
                    templateParams,
                    'tfi1ksSYUgEyQxZ6I'
                );
                
                console.log('‚úÖ Email enviado:', response);
                resultado.innerHTML = '<p>‚úÖ Email enviado exitosamente! Revisa tu bandeja de entrada.</p>';
                resultado.style.backgroundColor = '#d4edda';
                resultado.style.color = '#155724';
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultado.innerHTML = `<p>‚ùå Error enviando email: ${error.text || error.message}</p>`;
                resultado.style.backgroundColor = '#f8d7da';
                resultado.style.color = '#721c24';
            }
        }
        
        // Funci√≥n para probar modal de email
        function probarModalEmail() {
            const datosCita = {
                nombre: 'Juan P√©rez',
                email: 'jorge777andres@gmail.com',
                fecha: '2024-02-05',
                hora: '10:30 AM',
                doctor: 'Dr. Garc√≠a',
                especialidad: 'Cirug√≠a Pl√°stica'
            };
            
            mostrarModalEmailPrueba(datosCita);
        }
        
        // Funci√≥n para mostrar modal de email de prueba
        function mostrarModalEmailPrueba(datosCita) {
            // Crear modal si no existe
            let modal = document.getElementById('modalEmailPrueba');
            if (!modal) {
                crearModalEmailPrueba();
                modal = document.getElementById('modalEmailPrueba');
            }
            
            // Actualizar informaci√≥n en el modal
            document.getElementById('modalNombrePacientePrueba').textContent = datosCita.nombre;
            document.getElementById('modalEmailPacientePrueba').textContent = datosCita.email;
            document.getElementById('modalFechaCitaPrueba').textContent = formatearFechaPrueba(datosCita.fecha);
            document.getElementById('modalHoraCitaPrueba').textContent = datosCita.hora;
            document.getElementById('modalDoctorPrueba').textContent = datosCita.doctor;
            document.getElementById('modalEspecialidadPrueba').textContent = datosCita.especialidad;
            
            // Guardar datos para env√≠o
            window.citaActualPrueba = datosCita;
            
            // Mostrar modal
            modal.style.display = 'block';
        }
        
        // Funci√≥n para crear el modal HTML de prueba
        function crearModalEmailPrueba() {
            const modalHTML = `
                <div id="modalEmailPrueba" style="display: none; position: fixed !important; z-index: 9999 !important; left: 0 !important; top: 0 !important; width: 100% !important; height: 100% !important; background-color: rgba(0,0,0,0.7) !important; font-family: Arial, sans-serif !important;">
                    <div style="background-color: #ffffff !important; margin: 5% auto !important; padding: 25px !important; border: none !important; border-radius: 12px !important; width: 90% !important; max-width: 550px !important; box-shadow: 0 8px 32px rgba(0,0,0,0.4) !important; position: relative !important;">
                        
                        <!-- Bot√≥n X para cerrar -->
                        <button id="btnCerrarModalPruebaX" style="position: absolute !important; top: 15px !important; right: 20px !important; background: none !important; border: none !important; font-size: 24px !important; cursor: pointer !important; color: #999 !important; padding: 0 !important; width: 30px !important; height: 30px !important; display: flex !important; align-items: center !important; justify-content: center !important;">√ó</button>
                        
                        <div style="text-align: center !important; margin-bottom: 25px !important;">
                            <h2 style="color: #2c3e50 !important; margin: 0 !important; font-size: 24px !important; font-weight: 600 !important;">üìß Enviar Email al Paciente</h2>
                        </div>
                        
                        <div>
                            <div style="background-color: #f8f9fa !important; padding: 20px !important; border-radius: 8px !important; margin-bottom: 25px !important; border: 1px solid #e9ecef !important;">
                                <h3 style="margin-top: 0 !important; margin-bottom: 15px !important; color: #495057 !important; font-size: 18px !important;">Informaci√≥n de la Cita:</h3>
                                <p style="margin: 8px 0 !important; color: #333 !important; font-size: 14px !important;"><strong>Paciente:</strong> <span id="modalNombrePacientePrueba"></span></p>
                                <p style="margin: 8px 0 !important; color: #333 !important; font-size: 14px !important;"><strong>Email:</strong> <span id="modalEmailPacientePrueba"></span></p>
                                <p style="margin: 8px 0 !important; color: #333 !important; font-size: 14px !important;"><strong>Fecha:</strong> <span id="modalFechaCitaPrueba"></span></p>
                                <p style="margin: 8px 0 !important; color: #333 !important; font-size: 14px !important;"><strong>Hora:</strong> <span id="modalHoraCitaPrueba"></span></p>
                                <p style="margin: 8px 0 !important; color: #333 !important; font-size: 14px !important;"><strong>Doctor:</strong> <span id="modalDoctorPrueba"></span></p>
                                <p style="margin: 8px 0 !important; color: #333 !important; font-size: 14px !important;"><strong>Especialidad:</strong> <span id="modalEspecialidadPrueba"></span></p>
                            </div>
                            
                            <p style="text-align: center !important; color: #6c757d !important; margin-bottom: 25px !important; font-size: 16px !important;">
                                ¬øDeseas enviar un email de confirmaci√≥n al paciente?
                            </p>
                        </div>
                        
                        <div style="text-align: center !important;">
                            <button id="btnEnviarEmailPrueba" style="background-color: #28a745 !important; color: white !important; padding: 14px 35px !important; border: none !important; border-radius: 6px !important; cursor: pointer !important; margin-right: 15px !important; font-size: 16px !important; font-weight: 500 !important; transition: background-color 0.2s !important;">
                                üìß Enviar Email
                            </button>
                            <button id="btnCerrarModalPrueba" style="background-color: #6c757d !important; color: white !important; padding: 14px 35px !important; border: none !important; border-radius: 6px !important; cursor: pointer !important; font-size: 16px !important; font-weight: 500 !important; transition: background-color 0.2s !important;">
                                Cerrar
                            </button>
                        </div>
                        
                        <div id="modalLoadingPrueba" style="display: none !important; text-align: center !important; margin-top: 20px !important;">
                            <p style="color: #007bff !important; font-size: 16px !important; margin: 0 !important;">Enviando email... ‚è≥</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Agregar event listeners
            document.getElementById('btnEnviarEmailPrueba').addEventListener('click', enviarEmailDesdeModalPrueba);
            document.getElementById('btnCerrarModalPrueba').addEventListener('click', cerrarModalPrueba);
            document.getElementById('btnCerrarModalPruebaX').addEventListener('click', cerrarModalPrueba);
            
            // Cerrar modal al hacer clic fuera
            document.getElementById('modalEmailPrueba').addEventListener('click', function(e) {
                if (e.target === this) {
                    cerrarModalPrueba();
                }
            });
        }
        
        // Funci√≥n para enviar email desde el modal de prueba
        async function enviarEmailDesdeModalPrueba() {
            if (!window.citaActualPrueba) {
                alert('‚ùå Error: No hay datos de cita disponibles');
                return;
            }
            
            const citaActual = window.citaActualPrueba;
            
            // Mostrar loading en el modal
            document.getElementById('modalLoadingPrueba').style.display = 'block';
            document.getElementById('btnEnviarEmailPrueba').disabled = true;
            document.getElementById('btnEnviarEmailPrueba').textContent = 'Enviando...';
            
            try {
                console.log('üìß Enviando email a:', citaActual.email);
                
                // Preparar datos del template
                const templateParams = {
                    to_email: citaActual.email,
                    to_name: citaActual.nombre,
                    fecha_cita: formatearFechaPrueba(citaActual.fecha),
                    hora_cita: citaActual.hora,
                    doctor: citaActual.doctor,
                    especialidad: citaActual.especialidad,
                    clinica_nombre: 'EVA Cirug√≠a Corporal',
                    clinica_direccion: 'Av. Principal 123, Ciudad',
                    clinica_telefono: '(555) 123-4567'
                };
                
                // Enviar email
                const response = await emailjs.send(
                    'service_2re2org',
                    'template_rxar2ok',
                    templateParams,
                    'tfi1ksSYUgEyQxZ6I'
                );
                
                console.log('‚úÖ EMAIL ENVIADO EXITOSAMENTE!', response);
                alert('‚úÖ Email enviado correctamente al paciente!');
                cerrarModalPrueba();
                
                // Actualizar resultado en la p√°gina
                const resultado = document.getElementById('resultado');
                resultado.innerHTML = '<p>‚úÖ Email enviado desde el modal exitosamente!</p>';
                resultado.style.backgroundColor = '#d4edda';
                resultado.style.color = '#155724';
                
            } catch (error) {
                console.error('‚ùå ERROR ENVIANDO EMAIL:', error);
                alert('‚ùå Error enviando email. Revisa la consola para m√°s detalles.');
                
                // Actualizar resultado en la p√°gina
                const resultado = document.getElementById('resultado');
                resultado.innerHTML = `<p>‚ùå Error enviando email desde modal: ${error.text || error.message}</p>`;
                resultado.style.backgroundColor = '#f8d7da';
                resultado.style.color = '#721c24';
            } finally {
                // Restaurar bot√≥n
                document.getElementById('modalLoadingPrueba').style.display = 'none';
                document.getElementById('btnEnviarEmailPrueba').disabled = false;
                document.getElementById('btnEnviarEmailPrueba').textContent = 'üìß Enviar Email';
            }
        }
        
        // Funci√≥n para cerrar modal de prueba
        function cerrarModalPrueba() {
            const modal = document.getElementById('modalEmailPrueba');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Funci√≥n para formatear fecha de prueba
        function formatearFechaPrueba(fecha) {
            const opciones = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            return new Date(fecha).toLocaleDateString('es-ES', opciones);
        }
    </script>
</body>
</html>